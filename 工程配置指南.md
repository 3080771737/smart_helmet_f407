# STM32F407智能安全帽工程配置指南

## ✅ 已完成的工作

### 1. CubeMX配置
- ✅ 芯片：STM32F407VETx
- ✅ 时钟：168MHz (无警告)
- ✅ 外设：I2C1/SPI1/SDIO/USART1/ADC1/TIM1
- ✅ 代码已生成到：`F:\RT\smart_helmet_f407\`

### 2. 调度器框架
- ✅ 已创建 `APP/scheduler.c` 和 `APP/scheduler.h`
- ✅ 已创建测试任务 `APP/test_task.c`
- ✅ 已修改 `main.c` 添加调度器调用

---

## 📋 下一步操作（必须手动完成）

### 步骤1: 打开Keil工程
1. 双击打开：`F:\RT\smart_helmet_f407\MDK-ARM\smart_helmet_f407.uvprojx`

### 步骤2: 添加APP文件夹到工程
1. 在Keil左侧Project窗口，右键点击 `Target 1` 下的任意Group
2. 选择 `Add Group`，输入组名：`APP`
3. 右键点击新建的 `APP` 组
4. 选择 `Add Existing Files to Group 'APP'`
5. 浏览到：`F:\RT\smart_helmet_f407\APP\`
6. 按住Ctrl键，多选以下文件：
   - `scheduler.c`
   - `test_task.c`
7. 点击 `Add` 添加文件

### 步骤3: 添加头文件路径
1. 点击工具栏的魔术棒图标（Options for Target）
2. 选择 `C/C++` 标签页
3. 在 `Include Paths` 右侧点击 `...` 按钮
4. 点击新建文件夹图标
5. 输入：`../APP`
6. 点击 `OK` 保存

### 步骤4: 编译工程
1. 点击 `Build` 按钮（或按F7）
2. 检查编译输出：
   ```
   0 Error(s), 0 Warning(s).
   ```

---

## 🎯 编译成功后的现象

### LED测试
- **PC13 LED** 会每500ms闪烁一次
- 说明调度器工作正常

### 下一步工作
编译成功后，可以开始移植传感器驱动：

1. **ICM-20608-G** (替代MPU6050)
2. **AHT20** (替代DHT11)
3. **MAX30102** (心率血氧)
4. **GPS/WiFi模块**

---

## ⚠️ 常见问题

### 问题1: 找不到scheduler.h
**解决**: 确认步骤3已添加 `../APP` 到Include Paths

### 问题2: undefined reference to scheduler_init
**解决**: 确认步骤2已添加 `scheduler.c` 到工程

### 问题3: 编译有warning
**解决**: 忽略HAL库的警告，只关注APP代码的错误

---

## 📊 工程结构

```
smart_helmet_f407/
├── APP/                        # 应用层代码 ✅
│   ├── scheduler.c/h          # 任务调度器
│   └── test_task.c/h          # LED测试任务
├── Core/                       # HAL核心代码
│   └── Src/main.c             # 已修改，添加调度器
├── Drivers/                    # HAL库
└── MDK-ARM/                    # Keil工程 ✅
    └── smart_helmet_f407.uvprojx
```

---

**当前状态**: 等待你在Keil中手动添加APP文件夹并编译 🚀
