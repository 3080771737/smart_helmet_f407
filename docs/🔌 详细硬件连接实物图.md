# 🔌 STM32智能安全帽 - 详细硬件连接实物图

> **最后更新**: 2025-12-03
> **适用板卡**: STM32F407VET6
> **电源方案**: 面包板电源模块

---

## 📐 **整体布局俯视图**

```
                    DC 9V/12V 适配器
                          ↓
    ┌─────────────────────────────────────────────────────────────┐
    │                    面包板 (830孔)                            │
    │                                                              │
    │  ┌───────────────────────────────────────┐                 │
    │  │     [面包板电源模块]                   │                 │
    │  │      ┌─────────────────┐              │                 │
    │  │      │  ●红色开关●     │              │                 │
    │  │      │  ┌USB┐          │              │                 │
    │  │      │  └───┘          │              │                 │
    │  │      │  [绿色端子]     │              │                 │
    │  │      └─────────────────┘              │                 │
    │  │        ↓↓↓↓↓ (黄色排针插入面包板)     │                 │
    │  └───────────────────────────────────────┘                 │
    │                                                              │
    │  ════════════════════════════════════════  ← 3.3V总线(红+)  │
    │  ────────────────────────────────────────  ← GND总线(蓝-)   │
    │  ════════════════════════════════════════  ← 5V总线(红+)    │
    │  ────────────────────────────────────────  ← GND总线(蓝-)   │
    │                                                              │
    │     区域1                区域2              区域3            │
    │  ┌──────────┐       ┌──────────┐       ┌──────────┐       │
    │  │MAX30102  │       │   GPS    │       │ ESP01S   │       │
    │  │  ●●红光  │       │  [天线]  │       │  ●蓝灯   │       │
    │  └──────────┘       └──────────┘       └──────────┘       │
    │                                                              │
    │     区域4                区域5                               │
    │  ┌──────────┐       ┌──────────┐                           │
    │  │ ASR-PRO  │       │   MQ2    │                           │
    │  │ 🔊扬声器 │       │  ●●传感器│                           │
    │  └──────────┘       └──────────┘                           │
    │                                                              │
    └──────────────────────────────────────────────────────────────┘
                              ↑↑↑
                         信号线飞线连接
                              ↓↓↓
    ┌─────────────────────────────────────────────────────────────┐
    │              STM32F407VET6 开发板                            │
    │  ┌──────────────────────────────────────────────────────┐  │
    │  │  PA0 PA2 PA3 ... PA9 PA10 ... PB10 PB11 PB14 PB15   │  │
    │  │  [                     引脚排列                     ] │  │
    │  │                                                        │  │
    │  │               [STM32芯片]                             │  │
    │  │                                                        │  │
    │  │  [USB口]  [JTAG/SWD]  [复位键]  [LED]                │  │
    │  └──────────────────────────────────────────────────────┘  │
    └─────────────────────────────────────────────────────────────┘
                    ↑
              STLink/JLink
```

---

## 🔋 **电源模块详细连接图**

### **电源模块正面示意**

```
面包板电源模块 (你的模块)
┌─────────────────────────────────────┐
│                                     │
│    ●────●  红色拨动开关             │
│                                     │
│    ┌────┐                           │
│    │USB │  USB输入口(可选)          │
│    └────┘                           │
│                                     │
│    [+] [-]  绿色接线端子            │
│     ↑   ↑   (DC输入)                │
│     红  黑                           │
│                                     │
│  ┌──────────────────┐               │
│  │ 220μF  AMS1117   │ 稳压芯片      │
│  │  ●●    [芯片]    │               │
│  └──────────────────┘               │
│                                     │
│  ●●●●●●●●  黄色排针(左侧)           │
│  3V3 GND ...                        │
│                                     │
│  ●●●●●●●●  黄色排针(右侧)           │
│  5V  GND ...                        │
│                                     │
└─────────────────────────────────────┘
         ↓ ↓ ↓ ↓  插入面包板
```

### **电源输入连接**

```
方案A: DC适配器 (推荐)
┌──────────────┐
│  DC适配器    │
│  9V/12V 1A   │
│   ●───●      │
└───┬───┬──────┘
    │   │
   红  黑
    │   │
    ↓   ↓
┌───────────────┐
│ 绿色接线端子   │
│  [+]    [-]   │  ← 用小螺丝刀拧紧
│   ↑      ↑    │
│  红线   黑线  │
└───────────────┘

⚠️ 极性一定不能接反！
   红线(+) → 接线端子的 [+]
   黑线(-) → 接线端子的 [-]


方案B: USB供电
┌──────────────┐
│  USB充电器   │
│  5V 2A       │
│   ●──────●   │
└──────┬───────┘
       │
    USB线
       │
       ↓
┌───────────────┐
│  模块USB口    │
│  ┌────┐       │
│  │USB │       │
│  └────┘       │
└───────────────┘
```

### **电源输出到面包板**

```
电源模块底部黄色排针插入面包板后:

左侧排针输出:
  Pin 1: 3.3V  ──→  连接面包板左上红色(+)轨道
  Pin 2: GND   ──→  连接面包板左上蓝色(-)轨道
  Pin 3: 3.3V  ──→  可选，增强供电
  Pin 4: ...

右侧排针输出:
  Pin 1: 5V    ──→  连接面包板右上红色(+)轨道
  Pin 2: GND   ──→  连接面包板右上蓝色(-)轨道
  Pin 3: 5V    ──→  可选，增强供电
  Pin 4: ...

面包板供电轨道自动分配:
┌────────────────────────────────┐
│ ════════════════════════════  │ ← 左侧3.3V轨
│ ────────────────────────────  │ ← GND轨
│                                │
│  [工作区域 - 插传感器模块]     │
│                                │
│ ════════════════════════════  │ ← 右侧5V轨
│ ────────────────────────────  │ ← GND轨
└────────────────────────────────┘
```

---

## 🔌 **各模块详细连接图**

### **模块1: MAX30102 心率血氧传感器**

```
MAX30102模块实物图:
┌─────────────────────┐
│   ┌─────────┐       │
│   │  ●   ●  │       │ ← 红光LED传感器
│   │         │       │
│   └─────────┘       │
│                     │
│  ● VCC (红点标记)   │
│  ● GND (黑点标记)   │
│  ● SCL (黄点标记)   │
│  ● SDA (绿点标记)   │
│  ● INT (不用)       │
└─────────────────────┘

连接方式:
MAX30102              面包板/STM32
  VCC ─────红线─────→  3.3V轨道 (面包板左上红色+)
  GND ─────黑线─────→  GND轨道  (面包板蓝色-)
  SCL ─────黄线─────→  STM32 PB14
  SDA ─────绿线─────→  STM32 PB15
  INT     (不接)

接线步骤:
1. 取1根红色杜邦线(公对母): MAX30102的VCC → 插入面包板3.3V轨道
2. 取1根黑色杜邦线(公对母): MAX30102的GND → 插入面包板GND轨道
3. 取1根黄色杜邦线(公对公): MAX30102的SCL → STM32的PB14引脚
4. 取1根绿色杜邦线(公对公): MAX30102的SDA → STM32的PB15引脚

测试方法:
- 手指轻触传感器，红光应该亮起并闪烁
```

---

### **模块2: MQ2 烟雾传感器**

```
MQ2模块实物图:
┌─────────────────────┐
│   ┌─────────┐       │
│   │  ● ●    │       │ ← MQ2气体传感器(金属网罩)
│   │  传感器 │       │
│   └─────────┘       │
│                     │
│  ● VCC (标记+)      │
│  ● GND (标记-)      │
│  ● DO  (数字输出)   │
│  ● AO  (模拟输出)   │
│                     │
│  LED1 ● (电源指示)  │
│  LED2 ● (报警指示)  │
└─────────────────────┘

连接方式:
MQ2                   面包板/STM32
  VCC ─────红线─────→  5V轨道 (面包板右上红色+) ⚠️注意:5V!
  GND ─────黑线─────→  GND轨道 (面包板蓝色-)
  AO  ─────白线─────→  STM32 PA0
  DO      (不接)

接线步骤:
1. 取1根红色杜邦线(公对母): MQ2的VCC → 插入面包板5V轨道
2. 取1根黑色杜邦线(公对母): MQ2的GND → 插入面包板GND轨道
3. 取1根白色杜邦线(公对公): MQ2的AO → STM32的PA0引脚

测试方法:
- 上电后LED1(电源)应该亮起
- MQ2传感器会微微发热(正常现象)
- 用打火机(不点燃)靠近传感器，串口数值应上升
```

---

### **模块3: ATGM336H GPS模块**

```
GPS模块实物图:
┌─────────────────────┐
│  ┌───────────────┐  │
│  │   天线陶瓷片  │  │ ← GPS天线(白色方块)
│  │  (朝上放置)   │  │
│  └───────────────┘  │
│                     │
│  ● VCC (3.3V)       │
│  ● GND              │
│  ● TX  (GPS发送)    │
│  ● RX  (GPS接收)    │
│  ● PPS (秒脉冲)     │
│                     │
│  LED ● (定位指示)   │
│  闪烁=搜星中        │
│  常亮=已定位        │
└─────────────────────┘

连接方式 (⚠️注意TX/RX交叉):
GPS                   面包板/STM32
  VCC ─────红线─────→  3.3V轨道 (面包板左上红色+)
  GND ─────黑线─────→  GND轨道  (面包板蓝色-)
  TX  ─────橙线─────→  STM32 PA3 (USART2_RX) ← GPS发送，STM32接收
  RX  ─────棕线─────→  STM32 PA2 (USART2_TX) ← GPS接收，STM32发送
  PPS     (不接)

接线步骤:
1. 取1根红色杜邦线: GPS的VCC → 插入面包板3.3V轨道
2. 取1根黑色杜邦线: GPS的GND → 插入面包板GND轨道
3. 取1根橙色杜邦线: GPS的TX → STM32的PA3引脚
4. 取1根棕色杜邦线: GPS的RX → STM32的PA2引脚

为什么要交叉连接？
GPS的TX(发送) 要连到 STM32的RX(接收) → 所以GPS TX连PA3
GPS的RX(接收) 要连到 STM32的TX(发送) → 所以GPS RX连PA2

测试方法:
- GPS模块LED开始闪烁(1秒1次)
- 将GPS放到窗边或户外，等待1-3分钟
- LED闪烁变快或常亮表示已定位
```

---

### **模块4: ESP01S WiFi模块**

```
ESP01S模块实物图 (8个引脚):
┌─────────────────────┐
│   [ESP8266芯片]     │
│                     │
│  ●  ●  ●  ●         │
│  1  2  3  4         │
│  ●  ●  ●  ●         │
│  5  6  7  8         │
│                     │
│  LED ● (WiFi指示)   │
└─────────────────────┘

引脚定义:
1-GND   2-GPIO2(不用)  3-GPIO0(不用)  4-RX
5-TX    6-EN(使能)     7-RST(复位)     8-VCC

连接方式 (⚠️注意TX/RX交叉):
ESP01S                面包板/STM32
  8-VCC ────红线────→  3.3V轨道 (面包板左上红色+)
  1-GND ────黑线────→  GND轨道  (面包板蓝色-)
  6-EN  ────红线────→  3.3V轨道 (拉高使能)
  7-RST ────红线────→  3.3V轨道 (拉高不复位)
  5-TX  ────蓝线────→  STM32 PB11 (USART3_RX)
  4-RX  ────紫线────→  STM32 PB10 (USART3_TX)
  2-GPIO2  (不接)
  3-GPIO0  (不接)

接线步骤:
1. 取3根红色杜邦线:
   - ESP01S的引脚8(VCC) → 面包板3.3V轨道
   - ESP01S的引脚6(EN)  → 面包板3.3V轨道
   - ESP01S的引脚7(RST) → 面包板3.3V轨道
2. 取1根黑色杜邦线: ESP01S的引脚1(GND) → 面包板GND轨道
3. 取1根蓝色杜邦线: ESP01S的引脚5(TX) → STM32的PB11引脚
4. 取1根紫色杜邦线: ESP01S的引脚4(RX) → STM32的PB10引脚

⚠️ 供电警告:
ESP01S峰值电流300mA，你的电源模块可以提供！
如果WiFi模块反复重启，检查供电是否稳定。

测试方法:
- 上电后蓝色LED应该闪烁
- 串口应该输出: ESP01S: Init Success
- 如果配置了WiFi，会显示: WiFi Connected
```

---

### **模块5: ASR-PRO 语音模块**

```
ASR-PRO模块实物图:
┌─────────────────────┐
│   ┌─────────┐       │
│   │ 🔊扬声器│       │ ← 扬声器(可发出声音)
│   └─────────┘       │
│                     │
│  [语音芯片]         │
│                     │
│  ● VCC (5V)         │
│  ● GND              │
│  ● TX  (模块发送)   │
│  ● RX  (模块接收)   │
└─────────────────────┘

连接方式 (⚠️注意TX/RX交叉):
ASR-PRO               面包板/STM32
  VCC ─────红线─────→  5V轨道 (面包板右上红色+) ⚠️注意:5V!
  GND ─────黑线─────→  GND轨道 (面包板蓝色-)
  TX  ─────粉线─────→  STM32 PA10 (USART1_RX)
  RX  ─────灰线─────→  STM32 PA9  (USART1_TX)

接线步骤:
1. 取1根红色杜邦线: ASR-PRO的VCC → 插入面包板5V轨道
2. 取1根黑色杜邦线: ASR-PRO的GND → 插入面包板GND轨道
3. 取1根粉色杜邦线: ASR-PRO的TX → STM32的PA10引脚
4. 取1根灰色杜邦线: ASR-PRO的RX → STM32的PA9引脚

测试方法:
- 上电后扬声器应该有"滴"一声提示音
- 串口应该输出: ASR-PRO: Init Success
```

---

### **模块6: USB转TTL调试模块**

```
USB转TTL模块实物图:
┌─────────────────────┐
│  ┌────────┐         │
│  │ USB口  │         │ ← 连接电脑
│  └────────┘         │
│                     │
│  [CH340芯片]        │
│                     │
│  ● VCC (不用)       │
│  ● GND              │
│  ● TX  (发送到PC)   │
│  ● RX  (从PC接收)   │
│                     │
│  LED ● (TX指示)     │
│  LED ● (RX指示)     │
└─────────────────────┘

连接方式 (⚠️注意TX/RX交叉，与ASR-PRO共用):
USB转TTL              面包板/STM32
  VCC     (不接)      自带USB供电
  GND ─────黑线─────→  GND轨道 (面包板蓝色-)
  TX  ─────────────→  STM32 PA10 (与ASR-PRO共用)
  RX  ─────────────→  STM32 PA9  (与ASR-PRO共用)

接线步骤:
1. 取1根黑色杜邦线: USB转TTL的GND → 插入面包板GND轨道
2. 取1根线: USB转TTL的TX → STM32的PA10引脚(与ASR-PRO TX共用)
3. 取1根线: USB转TTL的RX → STM32的PA9引脚(与ASR-PRO RX共用)
4. USB线连接电脑

测试方法:
- 打开串口助手，选择对应COM口，波特率115200
- 按STM32复位键，应该看到系统启动信息
```

---

## 🎨 **面包板实际布局参考图**

```
面包板顶视图 (推荐布局):

     电源模块区域
┌─────────────────────────────────────────────────────┐
│        [面包板电源模块插在这里]                      │
│  ════════════════════════════════════════════════  │ ← 3.3V
│  ──────────────────────────────────────────────── │ ← GND
│  ════════════════════════════════════════════════  │ ← 5V
│  ──────────────────────────────────────────────── │ ← GND
│                                                     │
│   [MAX30102]    [GPS模块]      [ESP01S]           │
│      区域1        区域2          区域3              │
│   插在左边      插在中间       插在右边             │
│   (3.3V)        (3.3V)         (3.3V)              │
│                                                     │
│                                                     │
│   [ASR-PRO]     [MQ2传感器]                        │
│      区域4        区域5                             │
│   插在左下      插在右下                            │
│   (5V)          (5V)                                │
│                                                     │
│                                                     │
│  信号线从这里飞线到STM32开发板 ───────→             │
└─────────────────────────────────────────────────────┘
```

### **推荐的线缆走线**

```
线缆颜色规划:
🔴 红色 → 所有VCC(3.3V/5V)
⚫ 黑色 → 所有GND
🟡 黄色 → I2C SCL
🟢 绿色 → I2C SDA
🟠 橙色 → UART TX(从模块出来)
🟤 棕色 → UART RX(到模块去)
⚪ 白色 → ADC模拟信号
🔵 蓝色 → 其他数字信号

整理建议:
1. 所有电源线(红黑)集中在面包板边缘
2. 信号线尽量短，避免缠绕
3. 每根线贴上标签纸，写明功能
4. 用扎带固定线束，保持整洁
```

---

## 📊 **完整接线检查表**

### **供电系统检查**

```
□ 电源模块已正确插入面包板
□ DC适配器或USB已连接
□ 红色开关已打开
□ 用万用表测量3.3V轨道 = 3.3V (±0.1V)
□ 用万用表测量5V轨道   = 5.0V (±0.2V)
□ 用万用表测量GND轨道相通
```

### **模块供电检查**

```
3.3V模块(从左侧3.3V轨道取电):
□ MAX30102 VCC → 3.3V轨道 ✓
□ GPS VCC → 3.3V轨道 ✓
□ ESP01S VCC → 3.3V轨道 ✓
□ ESP01S EN → 3.3V轨道 ✓
□ ESP01S RST → 3.3V轨道 ✓

5V模块(从右侧5V轨道取电):
□ MQ2 VCC → 5V轨道 ✓
□ ASR-PRO VCC → 5V轨道 ✓

所有模块GND:
□ MAX30102 GND → GND轨道 ✓
□ MQ2 GND → GND轨道 ✓
□ GPS GND → GND轨道 ✓
□ ESP01S GND → GND轨道 ✓
□ ASR-PRO GND → GND轨道 ✓
□ USB转TTL GND → GND轨道 ✓
```

### **信号线连接检查**

```
MAX30102 (软件I2C):
□ MAX30102 SCL → STM32 PB14 ✓
□ MAX30102 SDA → STM32 PB15 ✓

MQ2 (ADC):
□ MQ2 AO → STM32 PA0 ✓

GPS (UART2, 交叉连接):
□ GPS TX → STM32 PA3 (USART2_RX) ✓
□ GPS RX → STM32 PA2 (USART2_TX) ✓

ESP01S (UART3, 交叉连接):
□ ESP01S TX → STM32 PB11 (USART3_RX) ✓
□ ESP01S RX → STM32 PB10 (USART3_TX) ✓

ASR-PRO (UART1, 交叉连接):
□ ASR-PRO TX → STM32 PA10 (USART1_RX) ✓
□ ASR-PRO RX → STM32 PA9  (USART1_TX) ✓

USB转TTL (UART1, 与ASR-PRO共用):
□ USB转TTL TX → STM32 PA10 (USART1_RX) ✓
□ USB转TTL RX → STM32 PA9  (USART1_TX) ✓
```

---

## 🔍 **常见接线错误及排查**

### **错误1: 电源极性接反**

```
症状: 上电后模块冒烟、发烫、或无反应
原因: VCC和GND接反了
排查:
1. 立即断电！
2. 用万用表测量每个模块的VCC引脚，应该是正电压
3. 检查红线是否都接到了+，黑线是否都接到了-

预防: 接线前用万用表先测试面包板轨道电压
```

### **错误2: TX/RX没有交叉连接**

```
症状: 串口无输出，或乱码
原因: TX接到了TX，RX接到了RX(应该交叉)
排查:
1. 检查UART模块:
   - GPS TX应该接STM32 PA3 (RX)
   - GPS RX应该接STM32 PA2 (TX)
2. 同样检查ESP01S和ASR-PRO

记忆技巧:
模块的TX(发送) → STM32的RX(接收)
模块的RX(接收) → STM32的TX(发送)
```

### **错误3: 3.3V和5V接错**

```
症状:
- 3.3V模块接到5V → 模块烧毁
- 5V模块接到3.3V → 无法正常工作

容易搞错的模块:
✓ 3.3V供电: MAX30102, GPS, ESP01S
✓ 5V供电:   MQ2, ASR-PRO

排查: 用万用表测量每个模块VCC引脚的电压
```

### **错误4: ESP01S供电不足**

```
症状: ESP01S反复重启，WiFi连不上
原因: 供电电流不够(ESP01S峰值300mA)
解决:
1. 确保你的电源模块3.3V输出≥700mA
2. 检查电源模块和ESP01S之间的连接线是否牢固
3. 可以在ESP01S的VCC和GND之间并联一个100μF电容
```

### **错误5: GND没有共地**

```
症状: 串口乱码，传感器数据异常
原因: STM32和传感器的GND没有连接
排查:
1. 用万用表蜂鸣档测量:
   - STM32 GND ←→ 面包板GND轨道 (应该导通)
   - 每个模块GND ←→ 面包板GND轨道 (应该导通)
2. 确保所有黑线都接到了GND轨道
```

---

## 📸 **连接完成后的最终检查**

### **目视检查**

```
□ 所有红线(VCC)没有接到蓝色轨道(GND)
□ 所有黑线(GND)没有接到红色轨道(VCC)
□ 没有裸露的金属引脚相碰
□ 所有杜邦线插入牢固，没有松动
□ 面包板电源模块插稳了
□ 线路整齐，没有缠绕打结
```

### **万用表测试**

```
断电状态下:
□ 3.3V轨道与GND之间不导通(电阻很大)
□ 5V轨道与GND之间不导通(电阻很大)

上电状态下:
□ 3.3V轨道 = 3.3V ±0.1V
□ 5V轨道   = 5.0V ±0.2V
□ MAX30102 VCC引脚 = 3.3V
□ MQ2 VCC引脚 = 5.0V
□ GPS VCC引脚 = 3.3V
□ ESP01S VCC引脚 = 3.3V
□ ASR-PRO VCC引脚 = 5.0V
```

### **模块指示灯检查**

```
上电后应该看到:
□ 电源模块上的LED亮起
□ MQ2传感器的电源LED亮起
□ GPS模块的LED开始闪烁(1秒1次)
□ ESP01S的蓝色LED闪烁
□ MAX30102用手指触摸会发出红光
```

---

## 🎉 **连接完成！**

如果以上检查都通过了，恭喜你！硬件连接已经完成！

### **下一步:**

1. **烧录程序** → 打开Keil，编译并下载程序到STM32
2. **打开串口助手** → 115200波特率，查看输出
3. **按复位键** → 应该看到系统启动信息
4. **逐个测试模块** → 按照之前的测试方法验证功能

### **遇到问题?**

把以下信息告诉我:
- 串口完整输出
- 哪个模块有问题
- 万用表测量的电压值
- 模块指示灯状态

我会帮你快速排查！

---

**📅 文档创建时间**: 2025-12-03
**✍️ 作者**: Claude AI Assistant
**🔄 版本**: v1.0
**📧 反馈**: 如有疑问请在GitHub提Issue

---
